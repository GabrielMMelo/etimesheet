{% load static %}
<!DOCTYPE html>

<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>Timesheet</title>

	<link rel="stylesheet" type="text/css" href = "{% static 'bootstrap/compiler/bootstrap.css' %}">
	<script src="{% static 'jquery/dist/jquery.min.js' %}"></script>
	<script src="{% static 'bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
	<link rel="stylesheet" type="text/css" href="{% static 'bootstrap/compiler/style.css' %}">
</head>

<body>
<div class="container">
	<h2>TimeSheet EMakers</h2>

	<form method="POST" action="">
	{% csrf_token %}
		<div class="row">
			<div class="col">
				<label>Filtrar a tabela por nome:</label>
				<div id="name-select">
					<select class="custom-select" name="name">
						<option selected></option>
						{% for n in names %}
						<option value="{{ n.name }}">{{ n.name }}</option>
						{% endfor %}
					</select>
				</div>

				<button class="glyphicon glyphicon-plus btn btn-primary" onclick="createName()"></button>
			</div>

			<div class="col">
				<label>Filtrar a tabela por horário:</label>
				<div id="time-select">
					<select class="custom-select" name="time">
						<option selected></option>
						<option value="07:00">07:00</option>
						<option value="08:00">08:00</option>
						<option value="09:00">09:00</option>
						<option value="10:00">10:00</option>
						<option value="11:00">11:00</option>
						<option value="12:00">12:00</option>
						<option value="13:00">13:00</option>
						<option value="14:00">14:00</option>
						<option value="15:00">15:00</option>
						<option value="16:00">16:00</option>
						<option value="17:00">17:00</option>
						<option value="18:00">18:00</option>
						<option value="19:00">19:00</option>
						<option value="20:00">20:00</option>
						<option value="21:00">21:00</option>
						<option value="22:00">22:00</option>
					</select>
				</div>
			</div>

			<div class="col">
				<label>Filtrar a tabela por dia:</label>
				<div id="day-select">
					<select class="custom-select" name="day">
						<option selected></option>
						<option value="Dom">Dom</option>
						<option value="Seg">Seg</option>
						<option value="Ter">Ter</option>
						<option value="Qua">Qua</option>
						<option value="Qui">Qui</option>
						<option value="Sex">Sex</option>
						<option value="Sáb">Sáb</option>
					</select>
				</div>

            	<button type="submit" class="btn btn-outline-primary">
                	<span class="glyphicon glyphicon-search" aria-hidden="true"></span>Procurar
              	</button>
			</div>
  		</div>
	</form>

	<table id="horario" class="table table-striped table-bordered">
		<thead>
		  	<tr>
				<th>Horário</th>
				<th>Dom</th>
				<th>Seg</th>
				<th>Ter</th>
				<th>Qua</th>
				<th>Qui</th>
				<th>Sex</th>
				<th>Sáb</th>
		  	</tr>
		</thead>
		<tbody>
		  	<tr>
				<td>07:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		  	</tr>
		  	<tr>
				<td>08:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		 	</tr>
		  	<tr>
				<td>09:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		 	</tr>
		  	<tr>
				<td>10:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		  	</tr>
		  	<tr>
				<td>11:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		 	</tr>
		  	<tr>
				<td>12:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		  	</tr>
		 	<tr>
				<td>13:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		 	</tr>
		 	<tr>
				<td>14:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		 	</tr>
		  	<tr>
				<td>15:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
		  	<tr>
				<td>16:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		 	</tr>
		  	<tr>
				<td>17:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		  	</tr>
		  	<tr>
				<td>18:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		  	</tr>
		  	<tr>
				<td>19:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		  	</tr>
		  	<tr>
				<td>20:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		  	</tr>
		  	<tr>
				<td>21:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		  	</tr>
		  	<tr>
				<td>22:00</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
		  	</tr>
		</tbody>
  	</table>

  	{% for h in timesheet %}
		<script type="text/javascript">
		    var x = document.getElementById("horario").rows[ {{ h.row }} ].cells;
		    x[ {{ h.column }} ].innerHTML = "{{ h.name }}" + ", " + "{{ h.role }}";
		</script>
  	{% endfor %}

</div>

<!-- MODAL -->

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
			<h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" action="{% url 'save' %}">
				{% csrf_token %}
				<div class="modal-body">

					<div class="row">
						<div class="form-group col-md-6">
							<label>Nome:</label>
							<div id="name-select2"></div>
						</div>
						<div class="form-group col-md-6">
							<label>Cargo:</label>
							<input type="text" class="form-control" name="role">	
						</div>
					</div>

					<div class="form-row">
						<div class="form-group col-md-6">
							<label>Horário:</label>
							<div id="time-select2"></div>
						</div>
						<div class="form-group col-md-6">
							<label>Dia:</label>
							<div id="day-select2"></div>
						</div>
					</div>

					<div class="form-row">
						<div class="form-group col-md-6">
						    <label>Linha:</label>
						    <input type="text" readonly class="form-control-plaintext" id="modal_row" name="row">
						</div>
						<div class="form-group col-md-6">
							<label>Coluna:</label>
						    <input type="text" readonly class="form-control-plaintext" id="modal_column" name="column">
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-primary">Save changes</button>
				</div>
			</form>
		</div>
	</div>
</div>

<script type="text/javascript">
    // Get all td and assign an on click event for each one
    var schedules = document.getElementsByTagName("td");
    for (i=0; i<schedules.length; i++) {
        schedules[i].onclick = function () {
            var row = this.closest('tr').rowIndex;
            var column = this.closest('td').cellIndex;

            // Event triggered when modal is showed. Used to mount form input properly
            $('#exampleModal').on('show.bs.modal', function(){
                var modal = $(this);
                modal.find("#modal_row").val(row);
                modal.find("#modal_column").val(column);
            });

            if (column) $('#exampleModal').modal('show');
        };
    }

	// nao funciona dar um jeito de clonar o elemento html
	function createName(){
	    var select = document.getElementById("name-select");
	    var newSelect = select.cloneNode(true);
		document.body.appendChild(newSelect)
	}

	$(document).ready(function(){
    	$("#name-select2").html($("#name-select").html());
	});

	$(document).ready(function(){
   		$("#time-select2").html($("#time-select").html());
	});

	$(document).ready(function(){
   	 	$("#day-select2").html($("#day-select").html());
	});

</script>

</body>